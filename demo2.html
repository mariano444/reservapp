<!DOCTYPE html>
<html lang="es" class="h-full bg-gray-100">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Sistema de Reservas y Cat谩logo Profesional</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
        <script src="https://unpkg.com/vue3-star-ratings@1.1.0/dist/vue3-star-ratings.umd.js"></script>
        <script src="https://unpkg.com/lucide-vue-next" type="text/javascript"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
        <script src="https://sdk.mercadopago.com/js/v2"></script>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
            [v-cloak] { display: none; }
            body {
                font-family: 'Poppins', sans-serif;
                transition: background-color 0.3s, color 0.3s;
            }
            .reserved-slot {
                background-color: #FEE2E2;
                color: #9CA3AF;
                cursor: not-allowed;
            }
            .break-slot {
                background-color: #E5E7EB;
                color: #6B7280;
                cursor: not-allowed;
            }
            .card {
                background-color: white;
                border-radius: 1rem;
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
                transition: all 0.3s ease;
            }
            .card:hover {
                transform: translateY(-5px);
                box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }
            .btn {
                transition: all 0.3s ease;
            }
            .btn:hover {
                transform: translateY(-2px);
            }
            .selected-service {
                border-color: #4F46E5;
                background-color: #EEF2FF;
            }
            .selected-date, .selected-time {
                background-color: #4F46E5;
                color: white;
            }
            .step-indicator {
                display: flex;
                justify-content: space-between;
                margin-bottom: 2rem;
                position: relative;
            }
            .step-indicator::before {
                content: '';
                position: absolute;
                top: 50%;
                left: 0;
                right: 0;
                height: 2px;
                background-color: #E5E7EB;
                z-index: 1;
            }
            .step {
                width: 2.5rem;
                height: 2.5rem;
                border-radius: 50%;
                background-color: #fff;
                border: 2px solid #E5E7EB;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                color: #6B7280;
                position: relative;
                z-index: 2;
                transition: all 0.3s ease;
            }
            .step.active {
                border-color: #4F46E5;
                color: #4F46E5;
                transform: scale(1.1);
            }
            .step.completed {
                background-color: #4F46E5;
                border-color: #4F46E5;
                color: #fff;
            }
            .calendar {
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                gap: 0.5rem;
            }
            .calendar-day {
                aspect-ratio: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                border-radius: 0.5rem;
                cursor: pointer;
                transition: all 0.2s ease;
                position: relative;
                font-size: 0.875rem;
            }
            .calendar-day:hover:not(.selected-date):not(.disabled):not(.unavailable):not(.fully-booked) {
                background-color: #EEF2FF;
                transform: scale(1.05);
            }
            .calendar-day.disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }
            .time-slot {
                transition: all 0.2s ease;
            }
            .time-slot:hover:not(.selected-time):not(.disabled):not(.unavailable) {
                background-color: #EEF2FF;
                transform: scale(1.05);
            }
            .time-slot.disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }
            .fade-enter-active, .fade-leave-active {
                transition: opacity 0.5s ease;
            }
            .fade-enter-from, .fade-leave-to {
                opacity: 0;
            }
            .slide-fade-enter-active {
                transition: all 0.3s ease-out;
            }
            .slide-fade-leave-active {
                transition: all 0.3s cubic-bezier(1, 0.5, 0.8, 1);
            }
            .slide-fade-enter-from,
            .slide-fade-leave-to {
                transform: translateX(20px);
                opacity: 0;
            }
            .shake {
                animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) both;
                transform: translate3d(0, 0, 0);
            }
            @keyframes shake {
                10%, 90% { transform: translate3d(-1px, 0, 0); }
                20%, 80% { transform: translate3d(2px, 0, 0); }
                30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
                40%, 60% { transform: translate3d(4px, 0, 0); }
            }
            .promo-badge {
                position: absolute;
                top: 0.5rem;
                right: 0.5rem;
                background-color: #10B981;
                color: white;
                padding: 0.25rem 0.5rem;
                border-radius: 9999px;
                font-size: 0.75rem;
                font-weight: bold;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            .calendar-day.unavailable {
                background-color: #F3F4F6;
                color: #9CA3AF;
                cursor: not-allowed;
            }
            .time-slot.unavailable {
                background-color: #F3F4F6;
                color: #9CA3AF;
                cursor: not-allowed;
            }
            .calendar-day.fully-booked {
                background-color: #FEE2E2;
                cursor: not-allowed;
            }
            .calendar-day.limited-availability {
                background-color: #FEF3C7;
            }
            .limited-badge {
                position: absolute;
                top: 0;
                right: 0;
                background-color: #F59E0B;
                color: white;
                border-radius: 50%;
                width: 16px;
                height: 16px;
                font-size: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .calendar-container {
                max-width: 100%;
                overflow-x: auto;
            }
            .calendar-day {
                min-height: 60px;
            }
            @media (min-width: 640px) {
                .calendar-day {
                    min-height: 80px;
                }
            }
            .skeleton {
                animation: skeleton-loading 1s linear infinite alternate;
            }
            @keyframes skeleton-loading {
                0% {
                    background-color: hsl(200, 20%, 80%);
                }
                100% {
                    background-color: hsl(200, 20%, 95%);
                }
            }
            .ff {
                background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.1'%3E%3Cpath opacity='.5' d='M96 95h4v1h-4v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9zm-1 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9z'/%3E%3Cpath d='M6 5V0H5v5H0v1h5v94h1V6h94V5H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            }
            /* Add these new styles for improved responsiveness */
            @media (max-width: 640px) {
                .step-indicator {
                    flex-direction: column;
                    align-items: flex-start;
                }
                .step-indicator::before {
                    display: none;
                }
                .step {
                    margin-bottom: 1rem;
                }
                .calendar {
                    grid-template-columns: repeat(4, 1fr);
                }
                .calendar-day {
                    aspect-ratio: auto;
                    height: 60px;
                }
            }
            
            @media (min-width: 641px) and (max-width: 1024px) {
                .calendar {
                    grid-template-columns: repeat(5, 1fr);
                }
            }
            
            .booking-steps {
                display: flex;
                flex-wrap: wrap;
                gap: 1rem;
                justify-content: center;
            }
            
            .booking-step {
                flex: 1 1 300px;
                max-width: 100%;
            }
            
            .time-slots {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 0.5rem;
            }
            /* New styles for enhanced design
            .gradient-bg {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            } */
            .glass-effect {
                background: rgba(255, 255, 255, 0.25);
                backdrop-filter: blur(4px);
                -webkit-backdrop-filter: blur(4px);
                border: 1px solid rgba(255, 255, 255, 0.18);
            }
            .hover-scale {
                transition: transform 0.3s ease;
            }
            .hover-scale:hover {
                transform: scale(1.05);
            }
            .shadow-soft {
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }
            

            /* New styles for improved responsiveness */
            .booking-steps {
                display: flex;
                flex-wrap: nowrap;
                overflow-x: auto;
                gap: 1rem;
                padding-bottom: 1rem;
                margin-bottom: 2rem;
            }
            
            .booking-step {
                flex: 0 0 auto;
                width: 150px;
                text-align: center;
                padding: 1rem;
                background-color: #f3f4f6;
                border-radius: 0.5rem;
                transition: all 0.3s ease;
            }
            
            .booking-step.active {
                background-color: #4F46E5;
                color: white;
                transform: scale(1.05);
            }
            
            .booking-step-icon {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }
            
            .booking-step-text {
                font-size: 0.875rem;
            }
            
            @media (max-width: 640px) {
                .booking-steps {
                    justify-content: flex-start;
                }
                
                .booking-step {
                    width: 120px;
                }
                .calendar {
                grid-template-columns: repeat(3, 1fr);
            }
            
            }
        /* Promo icons styles */
        .promo-icons {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
        }
        
        .icon {
            font-style: normal;
        }
        
            /* New styles for improved responsiveness */
            .booking-steps {
                display: flex;
                flex-wrap: nowrap;
                overflow-x: auto;
                gap: 0.5rem;
                padding-bottom: 1rem;
                margin-bottom: 2rem;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            
            .booking-steps::-webkit-scrollbar {
                display: none;
            }
            
            .booking-step {
                flex: 0 0 auto;
                width: 80px;
                text-align: center;
                padding: 0.5rem;
                background-color: #f3f4f6;
                border-radius: 0.5rem;
                transition: all 0.3s ease;
            }
            
            .booking-step.active {
                background-color: #4F46E5;
                color: white;
                transform: scale(1.05);
            }
            
            .booking-step-icon {
                font-size: 1.25rem;
                margin-bottom: 0.25rem;
            }
            
            .booking-step-text {
                font-size: 0.75rem;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            @media (min-width: 640px) {
                .booking-step {
                    width: 100px;
                    padding: 0.75rem;
                }
                
                .booking-step-icon {
                    font-size: 1.5rem;
                }
                
                .booking-step-text {
                    font-size: 0.875rem;
                }
            }

           /* .gradient-bg {
    background: linear-gradient(135deg, #4338ca, #3b82f6);
  }*/
  
  .glass-card {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(10px);
    border-radius: 1rem;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  }
  
  .trust-badge {
    display: inline-flex;
    align-items: center;
    background-color: #e0f2fe;
    color: #0369a1;
    padding: 0.5rem 1rem;
    border-radius: 9999px;
    font-weight: 600;
    font-size: 0.875rem;
    margin-right: 0.5rem;
    margin-bottom: 0.5rem;
  }
  
  .trust-badge svg {
    width: 1.25rem;
    height: 1.25rem;
    margin-right: 0.5rem;
  }
  
  .enhanced-button {
    transition: all 0.3s ease;
    transform: translateY(0);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
  
  .enhanced-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
  }
  
  .security-info {
    font-size: 0.875rem;
    color: #4b5563;
    margin-top: 1rem;
  }
                  
            /* Enhanced styles for promotions */
            .promotions-container {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 1.5rem;
                padding: 1.5rem;
            }
            .promotion-card {
                background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
                border-radius: 1rem;
                overflow: hidden;
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
                transition: all 0.3s ease;
                position: relative;
            }
            .promotion-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
                opacity: 0;
                transition: opacity 0.3s ease;
            }
            .promotion-card:hover {
                transform: translateY(-5px) scale(1.02);
                box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }
            .promotion-card:hover::before {
                opacity: 1;
            }
            .promotion-content {
                padding: 1.5rem;
                color: white;
            }
            .promotion-header {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                margin-bottom: 1rem;
            }
            .promotion-title-container {
                flex-grow: 1;
            }
            .promotion-title {
                font-size: 1.5rem;
                font-weight: bold;
                margin-bottom: 0.25rem;
                text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            }
            .promotion-service {
                font-size: 1rem;
                opacity: 0.9;
                font-style: italic;
            }
            .promotion-price {
                font-size: 1.5rem;
                font-weight: bold;
                background-color: rgba(255, 255, 255, 0.2);
                padding: 0.5rem 1rem;
                border-radius: 9999px;
                white-space: nowrap;
            }
            .promotion-description {
                font-size: 1rem;
                margin-bottom: 1rem;
                opacity: 0.9;
                line-height: 1.5;
            }
            .promotion-meta {
                display: flex;
                justify-content: space-between;
                align-items: center;
                font-size: 0.875rem;
                margin-bottom: 1rem;
            }
            .promotion-expiry, .promotion-slots {
                background-color: rgba(255, 255, 255, 0.2);
                padding: 0.25rem 0.75rem;
                border-radius: 9999px;
                display: flex;
                align-items: center;
            }
            .promotion-expiry svg, .promotion-slots svg {
                width: 1rem;
                height: 1rem;
                margin-right: 0.25rem;
            }
            .countdown {
                font-size: 1rem;
                font-weight: bold;
                color: #FCD34D;
                text-align: center;
                margin-bottom: 1rem;
                display: flex;
                justify-content: center;
                align-items: center;
                background-color: rgba(0, 0, 0, 0.1);
                padding: 0.5rem;
                border-radius: 0.5rem;
            }
            .countdown svg {
                width: 1.25rem;
                height: 1.25rem;
                margin-right: 0.5rem;
            }
            .select-promotion-btn {
                background-color: rgba(255, 255, 255, 0.9);
                color: #4F46E5;
                font-weight: 600;
                padding: 0.75rem 1.5rem;
                border-radius: 9999px;
                transition: all 0.3s ease;
                display: block;
                width: 100%;
                text-align: center;
                text-transform: uppercase;
                letter-spacing: 0.05em;
            }
            .select-promotion-btn:hover {
                background-color: white;
                transform: translateY(-2px);
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }
            @keyframes pulse {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.05); }
            }
            .pulse-animation {
                animation: pulse 2s infinite;
            }
        </style>
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            primary: '#4F46E5',
                            secondary: '#10B981',
                            accent: '#F59E0B',
                        }
                    }
                }
            }
        </script>
    </head>
<body class="h-full">
    <div id="app" v-cloak class="min-h-screen flex flex-col bg-gray-50">
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8">
                <h1 class="text-3xl font-bold text-gray-900">{{ appTitle }}</h1>
                <p class="mt-1 text-sm text-gray-600">{{ appSubtitle }}</p>
            </div>
        </header>

        <!-- Add this just after the opening <body> tag -->
<div class="gradient-bg py-2 text-black text-center text-sm">
     Reservas seguras y garantizadas |  Satisfacci贸n del cliente
  </div>
  

  <main class="flex-grow">
    <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <div class="px-4 py-6 sm:px-0">
            <div class="bg-white overflow-hidden shadow-xl sm:rounded-lg">
                <div class="p-6 bg-white border-b border-gray-200">
                            <div class="mb-8 flex justify-center">
                                <div class="inline-flex rounded-md shadow-sm" role="group">
                                    <button @click="setCurrentTab('booking')" :class="['px-4 py-2 text-sm font-medium rounded-l-lg focus:z-10 focus:ring-2 focus:ring-primary focus:text-white', currentTab === 'booking' ? 'bg-primary text-white' : 'bg-white text-gray-900 hover:bg-gray-50']">
                                        Reservar un turno
                                    </button>
                                    <button @click="setCurrentTab('shop')" :class="['px-4 py-2 text-sm font-medium rounded-r-lg focus:z-10 focus:ring-2 focus:ring-primary focus:text-white', currentTab === 'shop' ? 'bg-primary text-white' : 'bg-white text-gray-900 hover:bg-gray-50']">
                                        Comprar Productos
                                    </button>
                                </div>
                            </div>

                            <Transition name="fade" mode="out-in">
                                <div v-if="currentTab === 'booking'" key="booking">
                                    <!-- Booking content -->
                                    <div v-if="isLoading" class="animate-pulse">
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                            <div v-for="i in 6" :key="i" class="bg-gray-200 p-6 rounded-lg h-48"></div>
                                        </div>
                                    </div>
                                    <div v-if="isLoading" class="animate-pulse">
                                        <!-- Loading skeleton remains unchanged -->
                                    </div>
                                    <div v-else-if="filteredServicesAndPartialPromos.length === 0" class="text-center py-12">
                                        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                            <path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
                                        </svg>
                                        <h3 class="mt-2 text-sm font-medium text-gray-900">No hay servicios disponibles</h3>
                                        <p class="mt-1 text-sm text-gray-500">Parece que no hay servicios disponibles en este momento.</p>
                                    </div>
                                    <div v-else>
                                        <div class="mb-8">
                                            <nav aria-label="Progress">
            <!-- Updated booking steps section -->
            <div v-if="!isLoading && filteredServices.length > 0">
                <div class="booking-steps">
                    <div v-for="step in 5" :key="step" 
                         :class="['booking-step', { 'active': currentStep >= step }]">
                        <div class="booking-step-icon">
                            <span v-if="step === 1"></span>
                            <span v-else-if="step === 2"></span>
                            <span v-else-if="step === 3"></span>
                            <span v-else-if="step === 4"></span>
                            <span v-else></span>
                        </div>
                        <div class="booking-step-text">
                            {{ ['Servicios', 'Fecha', 'Hora', 'Datos', 'Pago'][step - 1] }}
                        </div>
                    </div>
                </div>
            </div>
                                            </nav>
                                        </div>


                                        <Transition name="slide-fade" mode="out-in">
                                            <div v-if="currentStep === 1">
                                                <!-- Promotions Section -->

<!-- Enhanced Promotions Section with Expired Promotion Handling -->
<div v-if="fullPromotions.length > 0" class="mb-8">
    <h2 class="text-3xl font-bold text-gray-900 mb-6 text-center">Promociones Especiales</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div v-for="promo in fullPromotions" :key="promo.id" class="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg overflow-hidden shadow-lg transform transition-all duration-300 hover:scale-105">
            <div class="p-6 text-white">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h3 class="text-2xl font-bold mb-2">{{ promo.name }}</h3>
                        <p class="text-indigo-100 text-sm">{{ promo.description }}</p>
                    </div>
                    <div class="bg-white text-indigo-600 text-xl font-bold py-1 px-3 rounded-full">
                        ${{ promo.price }}
                    </div>
                </div>
                <p class="mb-4 text-lg">{{ promo.nombre_promo }}</p>
                <div class="flex justify-between items-center text-sm mb-4">
                    <span v-if="promo.expiry_date" class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        Expira: {{ formatDate(promo.expiry_date) }}
                    </span>
                    <span v-if="promo.available_slots" class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                        {{ promo.available_slots }} cupos
                    </span>
                </div>
                <div v-if="promo.countdown !== null" class="bg-white bg-opacity-20 text-white py-2 px-4 rounded-full text-center mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span v-if="promo.countdown > 0">Termina en: {{ formatCountdown(promo.countdown) }}</span>
                    <span v-else>Promoci贸n finalizada</span>
                </div>
                <button 
                    v-if="promo.countdown === null || promo.countdown > 0"
                    @click="selectPromotion(promo)" 
                    class="w-full bg-white text-indigo-600 font-bold py-2 px-4 rounded-full hover:bg-indigo-100 transition-colors duration-300">
                    Seleccionar
                </button>
                <div 
                    v-else
                    class="w-full bg-gray-400 text-white font-bold py-2 px-4 rounded-full text-center">
                    Promoci贸n finalizada
                </div>
            </div>
        </div>
    </div>
</div>
                                            
                                                    <!-- Services Section (including partial promotions) -->
                                                    <div class="space-y-6">
                                                        <h2 class="text-2xl font-semibold text-gray-900">Nuestros Servicios y Promociones</h2>
                                                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
                                                            <!-- Iteramos sobre todos los servicios y promociones -->
                                                            <div v-for="service in filteredServicesAndPartialPromos" 
                                                                 :key="service.id"
                                                                 @click="toggleService(service)"
                                                                 class="relative bg-white border rounded-lg shadow-sm p-6 cursor-pointer hover:border-primary focus:outline-none transition-all duration-300 ease-in-out transform hover:-translate-y-1 hover:shadow-md"
                                                                 :class="{'border-primary ring-2 ring-primary': isServiceSelected(service), 'border-gray-200': !isServiceSelected(service)}">
                                                                
                                                                <!-- Contenido del servicio -->
                                                                <div class="flex items-center justify-between">
                                                                    <div class="flex-1 truncate">
                                                                        <h3 class="text-sm font-medium text-gray-900">{{ service.name }}</h3>
                                                                        <p class="mt-1 text-xs text-gray-500">{{ service.description }}</p>
                                                                    </div>
                                                                    <svg v-if="isServiceSelected(service)" class="h-5 w-5 text-primary" viewBox="0 0 20 20" fill="currentColor">
                                                                        <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd" />
                                                                    </svg>
                                                                </div>
                                                                
                                                                <!-- Precio y etiqueta de promoci贸n -->
                                                                <div class="mt-4 flex items-center justify-between">
                                                                    <p class="text-sm font-medium text-gray-900">${{ service.price }}</p>
                                                                    <div v-if="service.promocion" 
                                                                         class="px-2 py-1 text-xs font-semibold rounded-full"
                                                                         :class="{'bg-green-100 text-green-800': !service.countdown && !service.available_slots, 
                                                                                  'bg-yellow-100 text-yellow-800': service.countdown || service.available_slots}">
                                                                        {{ service.nombre_promo || 'Promoci贸n' }}
                                                                    </div>
                                                                </div>
                                                                
                                                                <!-- Detalles adicionales para promociones limitadas -->
                                                                <div v-if="service.promocion && (service.countdown || service.available_slots)" class="mt-2 text-xs text-gray-600">
                                                                    <div v-if="service.countdown" class="flex items-center">
                                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                                        </svg>
                                                                        Termina en: {{ formatCountdown(service.countdown) }}
                                                                    </div>
                                                                    <div v-if="service.available_slots" class="flex items-center mt-1">
                                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                                                        </svg>
                                                                        {{ service.available_slots }} cupos disponibles
                                                                    </div>
                                                                </div>
                                                                
                                                                <!-- Bot贸n de selecci贸n -->
                                                                <button @click.stop="toggleService(service)" 
                                                                        class="mt-4 w-full bg-primary border border-transparent rounded-md py-2 px-4 flex items-center justify-center text-sm font-medium text-white hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-colors duration-200">
                                                                    {{ isServiceSelected(service) ? 'Deseleccionar' : 'Seleccionar' }}
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                            </div>
                                            <!-- Step 2: Select Date -->
                                            <div v-else-if="currentStep === 2" key="step2" class="space-y-6">
                                                <h2 class="text-2xl font-semibold text-gray-900">Selecciona una Fecha</h2>
                                                <div class="bg-white shadow overflow-hidden sm:rounded-lg">
                                                    <div class="px-4 py-5 sm:p-6">
                                                        <div class="flex items-center justify-between mb-4">
                                                            <button @click="previousMonth" class="p-1 rounded-full hover:bg-gray-200 transition-colors duration-200">
                                                                <svg class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                                                                </svg>
                                                            </button>
                                                            <h3 class="text-lg font-medium text-gray-900">{{ currentMonthName }} {{ currentYear }}</h3>
                                                            <button @click="nextMonth" class="p-1 rounded-full hover:bg-gray-200 transition-colors duration-200">
                                                                <svg class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                                                </svg>
                                                            </button>
                                                        </div>
                                                        <div class="grid grid-cols-7 gap-2 mb-2">
                                                            <div v-for="day in daysOfWeek" :key="day" class="text-center text-sm font-medium text-gray-700">
                                                                {{ day }}
                                                            </div>
                                                        </div>
                                                        <div class="grid grid-cols-7 gap-2">
                                                            <button v-for="(day, index) in calendarDays" :key="index"
                                                                    @click="selectDate(day.date)"
                                                                    :disabled="!isDateAvailable(day.date) || isDateInPast(day.date)"
                                                                    :class="[
                                                                        'p-2 text-center text-sm leading-none rounded-lg hover:bg-gray-100 focus:z-10 transition-colors duration-200',
                                                                        isToday(day.date) ? 'font-bold border border-primary' : 'font-normal',
                                                                        day.isCurrentMonth ? 'text-gray-900' : 'text-gray-400',
                                                                        isDateAvailable(day.date) && !isDateInPast(day.date) ? 'cursor-pointer' : 'cursor-not-allowed opacity-50',
                                                                        selectedDate && day.date.toDateString() === selectedDate.toDateString() ? 'bg-primary text-white' : ''
                                                                    ]"
                                                            >
                                                                <span class="block mb-1">{{ day.date.getDate() }}</span>
                                                                <span v-if="hasLimitedAvailability(day.date)" class="block text-xs mt-1 text-accent">Limitado</span>
                                                                <span v-if="isFullyBooked(day.date)" class="block text-xs mt-1 text-red-500">Completo</span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Step 3: Select Time -->
                                            <div v-else-if="currentStep === 3" key="step3" class="space-y-6">
                                                <h2 class="text-2xl font-semibold text-gray-900">Selecciona una Hora</h2>
                                                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
                                                    <button v-for="time in availableTimes" :key="time"
                                                            @click="selectTime(time)"
                                                            :disabled="!isTimeAvailable(time)"
                                                            :class="[
                                                                'px-4 py-2 text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-colors duration-200',
                                                                selectedTime === time ? 'bg-primary text-white' : 'bg-white text-gray-900 border border-gray-300',
                                                                isTimeAvailable(time) ? 'hover:bg-gray-50' : 'opacity-50 cursor-not-allowed'
                                                            ]"
                                                    >
                                                        {{ formatDisplayTime(time) }}
                                                    </button>
                                                </div>
                                            </div>

                                            <!-- Step 4: Contact Information -->
                                            <div v-else-if="currentStep === 4" key="step4" class="space-y-6">
                                                <form @submit.prevent="nextStep" class="space-y-6">
                                                    <div>
                                                        <label for="name" class="block text-sm font-medium text-gray-700">Nombre Completo</label>
                                                        <input type="text" id="name" v-model="clientName" required
                                                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm transition-colors duration-200">
                                                    </div>
                                                    <div>
                                                        <label for="phone" class="block text-sm font-medium text-gray-700">N煤mero de Tel茅fono</label>
                                                        <input type="tel" id="phone" v-model="clientPhone" required
                                                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm transition-colors duration-200">
                                                    </div>
                                                    <!--div>
                                                        <label for="email" class="block text-sm font-medium text-gray-700">Correo Electr贸nico</label>
                                                        <input type="email" id="email" v-model="clientEmail" required
                                                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm transition-colors duration-200">
                                                    </div-->
<!-- Add these trust badges in the booking form, just before the "Continuar" button in Step 4 -->
<div class="flex flex-wrap mb-4">
    <span class="trust-badge">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
      </svg>
      Datos Seguros
    </span>
    <span class="trust-badge">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
      </svg>
      Reserva Garantizada
    </span>
  </div>
  
  <!-- Add this security info text just after the "Continuar" button in Step 4 -->
  <p class="security-info">
     Tu informaci贸n est谩 protegida con encriptaci贸n de 256 bits.
  </p>
  
  <!-- Enhance the "Continuar" button in Step 4 with the new class -->
  <button type="submit"
          class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-colors duration-200 enhanced-button">
    Continuar
  </button>
                                                </form>
                                            </div>

                                            <!-- Step 5: Summary and Payment -->
                                            <div v-else-if="currentStep === 5" key="step5" class="space-y-6">
                                                <h2 class="text-2xl font-semibold text-gray-900">Resumen y Pago de Se帽a</h2>
                                                <div class="bg-gray-50 p-6 rounded-lg shadow">
                                                    <dl class="space-y-6">
                                                        <div>
                                                            <dt class="text-sm font-medium text-gray-500">Servicios</dt>
                                                            <dd class="mt-1 text-sm text-gray-900">
                                                                <ul class="list-disc pl-5 space-y-1">
                                                                    <li v-for="service in selectedServices" :key="service.id">
                                                                        {{ service.name }}
                                                                        <span v-if="service.promocion" class="text-secondary font-bold">({{ service.nombre_promo || 'Promoci贸n' }})</span>
                                                                    </li>
                                                                </ul>
                                                            </dd>
                                                        </div>
                                                        <div>
                                                            <dt class="text-sm font-medium text-gray-500">Fecha</dt>
                                                            <dd class="mt-1 text-sm text-gray-900">{{ formatDate(selectedDate) }}</dd>
                                                        </div>
                                                        <div>
                                                            <dt class="text-sm font-medium text-gray-500">Hora</dt>
                                                            <dd class="mt-1 text-sm text-gray-900">{{ selectedTime }}</dd>
                                                        </div>
                                                        <div>
                                                            <dt class="text-sm font-medium text-gray-500">Precio Total</dt>
                                                            <dd class="mt-1 text-sm text-gray-900">${{ totalPrice }}</dd>
                                                        </div>
                                                        <div>
                                                            <dt class="text-sm font-medium text-gray-500">Se帽a (10%)</dt>
                                                            <dd class="mt-1 text-sm text-gray-900">${{ depositAmount }}</dd>
                                                        </div>
                                                    </dl>
                                                </div>

                                                <div id="mercadopago-button-container"></div>

                                                <!--div class="flex items-center">
                                                    <input type="checkbox" id="terms" v-model="termsAccepted" required
                                                           class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded transition-colors duration-200">
                                                    <label for="terms" class="ml-2 block text-sm text-gray-900">
                                                        Acepto los <a href="#" @click.prevent="showTermsModal = true" class="text-primary hover:text-primary-dark underline">t茅rminos y condiciones</a>
                                                    </label>
                                                </div>

                                                <button @click="confirmBooking" :disabled="!termsAccepted || isProcessing"
                                                        class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200">
                                                    {{ isProcessing ? 'Procesando...' : 'Confirmar Reserva' }}
                                                </button-->
                                            </div>
                                        </Transition>

                                        <div class="mt-8 flex flex-wrap justify-between gap-4">
                                            <button v-if="currentStep > 1" @click="previousStep"
                                                    class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-colors duration-200">
                                                Anterior
                                            </button>
                                            <button v-if="currentStep < 5" @click="nextStep"
                                                    class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-colors duration-200">
                                                Siguiente
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div v-else-if="currentTab === 'shop'" key="shop">
                                    <!-- Shop content -->
                                    <div v-if="isLoading" class="animate-pulse">
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                            <div v-for="i in 6" :key="i" class="bg-gray-200 p-6 rounded-lg h-48"></div>
                                        </div>
                                    </div>
                                    <div v-else-if="filteredProducts.length === 0" class="text-center py-12">
                                        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                            <path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                                        </svg>
                                        <h3 class="mt-2 text-sm font-medium text-gray-900">No hay productos disponibles</h3>
                                        <p class="mt-1 text-sm text-gray-500">Parece que no hay productos disponibles en este momento.</p>
                                    </div>
                                    <div v-else>
                                        <h2 class="text-2xl font-semibold text-gray-900 mb-6">Cat谩logo de Productos</h2>
                                        <div class="grid grid-cols-1 gap-y-10 sm:grid-cols-2 gap-x-6 lg:grid-cols-3 xl:grid-cols-4 xl:gap-x-8">
                                            <div v-for="product in filteredProducts" :key="product.id" class="group">
                                                <div class="w-full aspect-w-1 aspect-h-1 bg-gray-200 rounded-lg overflow-hidden xl:aspect-w-7 xl:aspect-h-8">
                                                    <img src="https://via.placeholder.com/300" :alt="product.name" class="w-full h-full object-center object-cover group-hover:opacity-75 transition-opacity duration-300">
                                                </div>
                                                <h3 class="mt-4 text-sm text-gray-700">{{ product.name }}</h3>
                                                <p class="mt-1 text-lg font-medium text-gray-900">${{ product.price }}</p>
                                                <button @click="addToCart(product)" class="mt-3 w-full bg-primary border border-transparent rounded-md py-2 px-8 flex items-center justify-center text-sm font-medium text-white hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-colors duration-200">
                                                    Agregar al Carrito
                                                </button>
                                            </div>
                                        </div>

                                        <div v-if="cart.length > 0" class="mt-12 bg-white shadow overflow-hidden sm:rounded-lg">
                                            <div class="px-4 py-5 sm:px-6">
                                                <h3 class="text-lg leading-6 font-medium text-gray-900">Carrito de Compras</h3>
                                            </div>
                                            <div class="border-t border-gray-200">
                                                <dl>
                                                    <div v-for="(item, index) in cart" :key="index" class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                                        <dt class="text-sm font-medium text-gray-500">{{ item.name }}</dt>
                                                        <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2 flex justify-between">
                                                            <span>${{ item.price }}</span>
                                                            <button @click="removeFromCart(item)" class="text-red-600 hover:text-red-800 transition-colors duration-200">
                                                                Eliminar
                                                            </button>
                                                        </dd>
                                                    </div>
                                                </dl>
                                            </div>
                                            <div class="px-4 py-5 bg-white sm:p-6">
                                                <div class="flex justify-between items-center">
                                                    <span class="text-lg font-semibold text-gray-900">Total: ${{ cartTotal }}</span>
                                                    <button @click="checkoutAndRedirect" :disabled="isProcessing" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-colors duration-200">
                                                        {{ isProcessing ? 'Procesando...' : 'Finalizar Compra' }}
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </Transition>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Add this just before the closing </body> tag -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="glass-card p-6">
      <h2 class="text-2xl font-semibold mb-4">驴Por qu茅 elegirnos?</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="flex items-start">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <div>
            <h3 class="font-semibold">Reservas Garantizadas</h3>
            <p class="text-sm text-gray-600">Tu reserva est谩 100% garantizada.</p>
          </div>
        </div>
        <div class="flex items-start">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <div>
            <h3 class="font-semibold">Atenci贸n Personalizada</h3>
            <p class="text-sm text-gray-600">Estamos aqu铆 para ayudarte en todo momento.</p>
          </div>
        </div>
        <div class="flex items-start">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
          </svg>
          <div>
            <h3 class="font-semibold">Calidad Garantizada</h3>
            <p class="text-sm text-gray-600">Servicios y productos de alta calidad.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
        </main>

        <footer class="bg-white">
            <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 md:flex md:items-center md:justify-between lg:px-8">
                <div class="flex justify-center space-x-6 md:order-2">
                    <a href="#" class="text-gray-400 hover:text-gray-500 transition-colors duration-200">
                        <span class="sr-only">Facebook</span>
                        <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" clip-rule="evenodd" />
                        </svg>
                    </a>

                    <a href="#" class="text-gray-400 hover:text-gray-500 transition-colors duration-200">
                        <span class="sr-only">Instagram</span>
                        <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path fill-rule="evenodd" d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.067.06 1.407.06 4.123v.08c0 2.643-.012 2.987-.06 4.043-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.067.048-1.407.06-4.123.06h-.08c-2.643 0-2.987-.012-4.043-.06-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.047-1.024-.06-1.379-.06-3.808v-.63c0-2.43.013-2.784.06-3.808.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 015.45 2.525c.636-.247 1.363-.416 2.427-.465C8.901 2.013 9.256 2 11.685 2h.63zm-.081 1.802h-.468c-2.456 0-2.784.011-3.807.058-.975.045-1.504.207-1.857.344-.467.182-.8.398-1.15.748-.35.35-.566.683-.748 1.15-.137.353-.3.882-.344 1.857-.047 1.023-.058 1.351-.058 3.807v.468c0 2.456.011 2.784.058 3.807.045.975.207 1.504.344 1.857.182.466.399.8.748 1.15.35.35.683.566 1.15.748.353.137.882.3 1.857.344 1.054.048 1.37.058 4.041.058h.08c2.597 0 2.917-.01 3.96-.058.976-.045 1.505-.207 1.858-.344.466-.182.8-.398 1.15-.748.35-.35.566-.683.748-1.15.137-.353.3-.882.344-1.857.048-1.055.058-1.37.058-4.041v-.08c0-2.597-.01-2.917-.058-3.96-.045-.976-.207-1.505-.344-1.858a3.097 3.097 0 00-.748-1.15 3.098 3.098 0 00-1.15-.748c-.353-.137-.882-.3-1.857-.344-1.023-.047-1.351-.058-3.807-.058zM12 6.865a5.135 5.135 0 110 10.27 5.135 5.135 0 010-10.27zm0 1.802a3.333 3.333 0 100 6.666 3.333 3.333 0 000-6.666zm5.338-3.205a1.2 1.2 0 110 2.4 1.2 1.2 0 010-2.4z" clip-rule="evenodd" />
                        </svg>
                    </a>

                    <a href="#" class="text-gray-400 hover:text-gray-500 transition-colors duration-200">
                        <span class="sr-only">Twitter</span>
                        <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84" />
                        </svg>
                    </a>
                </div>
                <div class="mt-8 md:mt-0 md:order-1">
                    <p class="text-center text-base text-gray-400">&copy; 2023 {{ appTitle }}. Todos los derechos reservados.</p>
                </div>
            </div>
        </footer>

        <Transition name="fade">
            <div v-if="notification.show" :class="['fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg text-white', {
                'bg-green-500': notification.type === 'success',
                'bg-red-500': notification.type === 'error',
                'bg-blue-500': notification.type === 'info'
            }]">
                {{ notification.message }}
            </div>
        </Transition>

        <Transition name="fade">
            <div v-if="showTermsModal" class="fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center p-4 z-50">
                <div class="bg-white rounded-lg p-8 max-w-lg w-full max-h-[80vh] overflow-y-auto">
                    <h2 class="text-2xl font-bold mb-4 text-gray-900">T茅rminos y Condiciones</h2>
                    <div class="text-gray-700 space-y-4">
                        <p>1. Al realizar una reserva, usted acepta pagar una se帽a del 10% del valor total del servicio.</p>
                        <p>2. La se帽a no es reembolsable en caso de cancelaci贸n con menos de 24 horas de anticipaci贸n.</p>
                        <p>3. Los servicios est谩n sujetos a disponibilidad y pueden variar seg煤n la demanda.</p>
                        <p>4. Nos reservamos el derecho de modificar o cancelar reservas en circunstancias excepcionales.</p>
                        <p>5. La informaci贸n personal proporcionada ser谩 tratada de acuerdo con nuestra pol铆tica de privacidad.</p>
                    </div>
                    <button @click="showTermsModal = false" class="mt-6 bg-primary text-white px-4 py-2 rounded hover:bg-primary-dark transition-colors duration-200">
                        Cerrar
                    </button>
                </div>
            </div>
        </Transition>

        <Transition name="fade">
            <div v-if="showConfirmationModal" class="fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center p-4 z-50">
                <div class="bg-white rounded-lg p-8 max-w-lg w-full">
                    <h2 class="text-2xl font-bold mb-4 text-gray-900">隆Reserva Confirmada!</h2>
                    <p class="text-gray-700 mb-4">Tu reserva ha sido confirmada con 茅xito. Hemos enviado un resumen a tu correo electr贸nico.</p>
                    <p class="text-gray-900 font-semibold mb-2">N煤mero de Reserva: {{ bookingNumber }}</p>
                    <p class="text-gray-700 mb-4">Por favor, guarda este n煤mero para futuras referencias.</p>
                    <button @click="closeConfirmationModal" class="bg-primary text-white px-4 py-2 rounded hover:bg-primary-dark transition-colors duration-200">
                        Cerrar
                    </button>
                </div>
            </div>
        </Transition>

        <!--div class="fixed bottom-4 right-4">
            <button @click="showChat = !showChat" class="bg-primary text-white p-3 rounded-full shadow-lg hover:bg-primary-dark transition-colors duration-300">
                <svg v-if="!showChat" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                </svg>
                <svg v-else class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div-->

        <!--Transition name="slide-fade">
            <div v-if="showChat" class="fixed bottom-20 right-4 w-80 bg-white rounded-lg shadow-xl p-4 z-50">
                <div class="h-64 overflow-y-auto mb-4 space-y-2">
                    <div v-for="(message, index) in chatMessages" :key="index" :class="['p-2 rounded-lg', {
                        'bg-gray-200 text-gray-900': message.sender === 'user',
                        'bg-primary text-white': message.sender === 'support'
                    }]">
                        {{ message.text }}
                    </div>
                </div>
                <form @submit.prevent="sendMessage" class="flex">
                    <input v-model="chatInput" type="text" placeholder="Escribe tu mensaje..." class="flex-grow border rounded-l-lg p-2 focus:outline-none focus:ring-2 focus:ring-primary">
                    <button type="submit" class="bg-primary text-white px-4 py-2 rounded-r-lg hover:bg-primary-dark transition-colors duration-300">Enviar</button>
                </form>
            </div>
        </Transition-->
    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch, nextTick } = Vue;
        window.supabase = supabase.createClient(
                'https://tbtzlqeoogcfviojfqzg.supabase.co',
                'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRidHpscWVvb2djZnZpb2pmcXpnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzA0ODI0ODEsImV4cCI6MjA0NjA1ODQ4MX0.E4tlXIb8tTHySUkA-VMHpdrnep63prRi1PGsypCMjGQ'
            );

        createApp({
            setup() {
                // State variables
                const appTitle = ref('Reservas y Cat谩logo');
                const appSubtitle = ref('Reserva tus servicios y compra productos de calidad');
                const currentTab = ref('booking');
                const searchQuery = ref('');
                const services = ref([]);
                const products = ref([]);
                const selectedServices = ref([]);
                const currentStep = ref(1);
                const selectedDate = ref(null);
                const selectedTime = ref(null);
                const clientName = ref('');
                const clientPhone = ref('');
                const clientEmail = ref('');
                const paymentInfo = ref({ cardNumber: '', expiryDate: '', cvv: '' });
                const termsAccepted = ref(false);
                const cart = ref([]);
                const notification = ref({ show: false, message: '', type: 'success' });
                const showChat = ref(false);
                const chatMessages = ref([]);
                const chatInput = ref('');
                const showTermsModal = ref(false);
                const showConfirmationModal = ref(false);
                const bookingNumber = ref('');
                const loyaltyPoints = ref(0);
                const adminCode = ref(null);
                const businessHours = ref([]);
                const bookings = ref([]);
                const currentDate = ref(new Date());
                const adminPhoneNumber = ref('');
                const isProcessing = ref(false);
                const isLoading = ref(true);
                const promotions = ref([]);
                
                

                const fetchServices = async (adminCode) => {
    try {
        console.log('Fetching services for admin code:', adminCode.value);
        const { data, error } = await supabase
            .from('services')
            .select('*')
            .eq('admin_unique_code', adminCode.value) // Filtrar por admin_unique_code
            .eq('promocion', false); // Filtrar para obtener solo los servicios que no son promoci贸n
        if (error) throw error;
        console.log('Services fetched:', data);
        services.value = data.map(service => ({ ...service, rating: Math.random() * 5 }));
    } catch (error) {
        console.error('Error fetching services:', error);
        showNotification('Error al cargar los servicios. Por favor, intenta de nuevo.', 'error');
    }
};


            const fetchProducts = async () => {
    try {
        const { data, error } = await supabase
            .from('products')
            .select('*')
            .eq('admin_unique_code', adminCode.value);
        if (error) throw error;
        products.value = data;
    } catch (error) {
        console.error('Error fetching products:', error);
        showNotification('Error al cargar los productos. Por favor, intenta de nuevo.', 'error');
    }
};


onMounted(() => {
    const urlParams = new URLSearchParams(window.location.search);
    adminCode.value = urlParams.get('code');
    const paymentStatus = urlParams.get('status');
    
    if (paymentStatus === 'approved') {
        confirmBooking('approved');
    }
    
    Promise.all([
        fetchServices(adminCode), // Pasa adminCode a fetchServices
        fetchProducts(),
        fetchBusinessHours(),
        fetchBookings(),
        fetchAdminPhoneNumber(),
        fetchBusinessName(),
        fetchPromotions()
    ]).then(() => {
        isLoading.value = false;
    }).catch(error => {
        console.error('Error initializing app:', error);
        showNotification('Error al cargar los datos. Por favor, recarga la p谩gina.', 'error');
        isLoading.value = false;
    });
});




                const fullPromotions = computed(() => {
    return promotions.value.filter(promo => 
        promo.expiry_date || promo.available_slots || promo.countdown
    );
});

const partialPromotions = computed(() => {
    return promotions.value.filter(promo => 
        !promo.expiry_date && !promo.available_slots && !promo.countdown
    );
});

const filteredServicesAndPartialPromos = computed(() => {
    const regularServices = services.value.filter(service => !service.promocion);
    const combinedServices = [...regularServices, ...partialPromotions.value];
    
    return combinedServices.filter(service =>
        service.name.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
        service.description.toLowerCase().includes(searchQuery.value.toLowerCase())
    );
});

// Update the existing methods or add new ones as needed
const selectPromotion = (promo) => {
    toggleService(promo);
    currentStep.value = 2;
};

const toggleService = (service) => {
    const index = selectedServices.value.findIndex(s => s.id === service.id);
    if (index === -1) {
        selectedServices.value.push(service);
    } else {
        selectedServices.value.splice(index, 1);
    }
};

const isServiceSelected = (service) => {
    return selectedServices.value.some(s => s.id === service.id);
};

                const filteredServices = computed(() => {
    return services.value.filter(service =>
        (service.name.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
        service.description.toLowerCase().includes(searchQuery.value.toLowerCase())) &&
        !promotions.value.some(promo => promo.id === service.id)
    );
});

const fetchPromotions = async () => {
    try {
        console.log('Fetching promotions for admin code:', adminCode.value);
        const { data, error } = await supabase
            .from('services')
            .select('*')
            .eq('admin_unique_code', adminCode.value)
            .eq('promocion', true); // Aseg煤rate de que esta condici贸n es correcta
        if (error) throw error;
        console.log('Promotions fetched:', data);
        promotions.value = data.map(promo => ({
            ...promo,
            expiry_date: promo.expiry_date ? new Date(promo.expiry_date) : null,
            countdown: promo.countdown_end ? new Date(promo.countdown_end) - new Date() : null
        }));
    } catch (error) {
        console.error('Error fetching promotions:', error);
        showNotification('Error al cargar las promociones. Por favor, intenta de nuevo.', 'error');
    }
};



                const formatDate = (date) => {
                    return new Date(date).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' });
                };

                const formatCountdown = (milliseconds) => {
                    if (milliseconds <= 0) return 'Expirado';
                    const seconds = Math.floor(milliseconds / 1000);
                    const minutes = Math.floor(seconds / 60);
                    const hours = Math.floor(minutes / 60);
                    const days = Math.floor(hours / 24);
                    return `${days}d ${hours % 24}h ${minutes % 60}m ${seconds % 60}s`;
                };


                // Update countdown every second
                setInterval(() => {
                    promotions.value = promotions.value.map(promo => ({
                        ...promo,
                        countdown: promo.countdown ? promo.countdown - 1000 : null
                    }));
                }, 1000);


                const isTimeAvailable = (time) => {
        if (!selectedDate.value) return false;

        const bookingDate = selectedDate.value.toISOString().split('T')[0];
        const existingBookings = bookings.value.filter(booking =>
            booking.date === bookingDate
        );

        for (const booking of existingBookings) {
            const bookingStartTime = booking.time;
            const bookingEndTime = booking.end_time;
            
            // Incluye el slot de fin en la reserva
            if (bookingStartTime <= time && time <= bookingEndTime) {
                return false;
            }
        }

        return true;
    };

    const getReservationInfo = (time) => {
        if (!selectedDate.value) return '';

        const bookingDate = selectedDate.value.toISOString().split('T')[0];
        const existingBooking = bookings.value.find(booking => 
            booking.date === bookingDate && 
            booking.time <= time && 
            time <= booking.end_time
        );

        if (existingBooking) {
            return `${existingBooking.time} - ${existingBooking.end_time}`;
        }

        return '';
    };
            const addMinutesToTime = (time, minutes) => {
                const [hours, mins] = time.split(':').map(Number);
                const date = new Date(2000, 0, 1, hours, mins + minutes);
                return date.toTimeString().slice(0, 5);
            };


const getServiceDuration = (serviceName) => {
    const service = services.value.find(s => s.name === serviceName);
    return service ? service.duration : 0;
};


                const getReservedSlotNumber = (time) => {
    if (!selectedDate.value) return '';

    const bookingDate = selectedDate.value.toISOString().split('T')[0];
    const dayBookings = bookings.value.filter(booking => booking.date === bookingDate);
    
    // Sort bookings by time
    dayBookings.sort((a, b) => a.time.localeCompare(b.time));

    // Find the index of the current booking
    const bookingIndex = dayBookings.findIndex(booking => booking.time === time);

    return bookingIndex !== -1 ? bookingIndex : '';
};


                const filteredProducts = computed(() => {
                    return products.value.filter(product =>
                        product.name.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
                        product.description.toLowerCase().includes(searchQuery.value.toLowerCase())
                    );
                });

                const cartTotal = computed(() => {
                    return cart.value.reduce((total, item) => total + item.price, 0).toFixed(2);
                });

                const totalPrice = computed(() => {
                    return selectedServices.value.reduce((total, service) => total + service.price, 0).toFixed(2);
                });

                const depositAmount = computed(() => {
                    return (parseFloat(totalPrice.value) * 0.1).toFixed(2);
                });

                const currentMonthName = computed(() => {
                    const months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
                    return months[currentDate.value.getMonth()];
                });

                const currentYear = computed(() => {
                    return currentDate.value.getFullYear();
                });

                const daysOfWeek = ['Dom', 'Lun', 'Mar', 'Mi茅', 'Jue', 'Vie', 'S谩b'];

                const calendarDays = computed(() => {
                    const year = currentDate.value.getFullYear();
                    const month = currentDate.value.getMonth();
                    const firstDay = new Date(year, month, 1);
                    const lastDay = new Date(year, month + 1, 0);
                    const daysInMonth = lastDay.getDate();
                    const startingDay = firstDay.getDay();

                    const days = [];

                    // Add days from previous month
                    for (let i = startingDay - 1; i >= 0; i--) {
                        const prevMonthLastDay = new Date(year, month, 0).getDate();
                        days.push({
                            date: new Date(year, month - 1, prevMonthLastDay - i),
                            isCurrentMonth: false
                        });
                    }

                    // Add days of current month
                    for (let i = 1; i <= daysInMonth; i++) {
                        days.push({
                            date: new Date(year, month, i),
                            isCurrentMonth: true
                        });
                    }

                    // Add days from next month
                    const remainingDays = 42 - days.length;
                    for (let i = 1; i <= remainingDays; i++) {
                        days.push({
                            date: new Date(year, month + 1, i),
                            isCurrentMonth: false
                        });
                    }

                    return days;
                });

                // Methods
                const setCurrentTab = (tab) => currentTab.value = tab;


                const fetchBusinessName = async () => {
                    try {
                        const { data, error } = await supabase
                            .from('admin_configurations')
                            .select('business_name')
                            .eq('admin_unique_code', adminCode.value)
                            .single();
                        if (error) throw error;
                        appTitle.value = data.business_name;
                    } catch (error) {
                        console.error('Error fetching business name:', error);
                        showNotification('Error al cargar el nombre del negocio. Por favor, intenta de nuevo.', 'error');
                    }
                };

                const fetchBusinessHours = async () => {
                    try {
                        const { data, error } = await supabase
                            .from('admin_configurations')
                            .select('working_hours')
                            .eq('admin_unique_code', adminCode.value)
                            .single();
                        if (error) throw error;
                        businessHours.value = JSON.parse(data.working_hours);
                    } catch (error) {
                        console.error('Error fetching business hours:', error);
                        showNotification('Error al cargar los horarios de negocio. Por favor, intenta de nuevo.', 'error');
                    }
                };

                const fetchBookings = async () => {
                    try {
                        const { data, error } = await supabase
                            .from('bookings')
                            .select('*')
                            .eq('admin_unique_code', adminCode.value);
                        if (error) throw error;
                        bookings.value = data;
                    } catch (error) {
                        console.error('Error fetching bookings:', error);
                        showNotification('Error al cargar las reservas existentes. Por favor, intenta de nuevo.', 'error');
                    }
                };

                const generateUUID = () => {
                    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                        const r = Math.random() * 16 | 0,
                              v = c === 'x' ? r : (r & 0x3 | 0x8);
                        return v.toString(16);
                    });
                };



                const preferenceId = ref(null);
                const isProcessingPayment = ref(false);


                const initMercadoPago = async () => {
                    await createMercadoPagoPreference();
                    if (preferenceId.value) {
                        const mp = new MercadoPago('APP_USR-a222a3c7-3f87-46c5-afe1-c172aa35323d', {
                            locale: 'es-AR'
                        });

                        const checkout = mp.checkout({
                            preference: {
                                id: preferenceId.value
                            },
                            render: {
                                container: '#mercadopago-button-container',
                                label: 'Pagar con MercadoPago',
                            }
                        });

                        checkout.on('payment_received', (data) => {
                            confirmBooking(data.status);
                        });
                    } else {
                        showNotification('Error al inicializar el pago. Por favor, intenta de nuevo.', 'error');
                    }
                };

                const retrieveBookingDetails = () => {
                    const storedDetails = localStorage.getItem('bookingDetails');
                    if (storedDetails) {
                        const details = JSON.parse(storedDetails);
                        selectedServices.value = details.selectedServices;
                        selectedDate.value = new Date(details.selectedDate);
                        selectedTime.value = details.selectedTime;
                        clientName.value = details.clientName;
                        clientPhone.value = details.clientPhone;
                        clientEmail.value = details.clientEmail;
                        // No need to set totalPrice and depositAmount as they are computed properties
                    }
                };

                const storeBookingDetails = () => {
                    const bookingDetails = {
                        selectedServices: selectedServices.value,
                        selectedDate: selectedDate.value,
                        selectedTime: selectedTime.value,
                        clientName: clientName.value,
                        clientPhone: clientPhone.value,
                        clientEmail: clientEmail.value,
                        totalPrice: totalPrice.value,
                        depositAmount: depositAmount.value
                    };
                    localStorage.setItem('bookingDetails', JSON.stringify(bookingDetails));
                };

                const createMercadoPagoPreference = async () => {
                    try {
                        storeBookingDetails(); // Store details before creating preference
                        const response = await fetch('https://api.mercadopago.com/checkout/preferences', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': 'Bearer APP_USR-8142007441986200-111615-e50b20f8c3dc747c1b6b6bfa7924cc3e-1670125470'
                            },
                            body: JSON.stringify({
                                items: [
                                    {
                                        title: 'Se帽a para reserva de servicios',
                                        unit_price: parseFloat(depositAmount.value),
                                        quantity: 1,
                                    }
                                ],
                                payer: {
                                    name: clientName.value,
                                    email: clientEmail.value,
                                    phone: {
                                        number: clientPhone.value
                                    }
                                },
                                back_urls: {
                                    success: window.location.href,
                                    failure: window.location.href,
                                    pending: window.location.href
                                },
                                auto_return: 'approved',
                            })
                        });

                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }

                        const data = await response.json();
                        preferenceId.value = data.id;
                    } catch (error) {
                        console.error('Error creating MercadoPago preference:', error);
                        showNotification('Error al crear la preferencia de pago. Por favor, intenta de nuevo.', 'error');
                    }
                };


    const simulatePaymentProcess = () => {
        return new Promise((resolve) => {
            setTimeout(() => {
                resolve({ status: 'approved' });
            }, 2000);
        });
    };

                const selectDate = (date) => {
                    if (isDateAvailable(date) && !isDateInPast(date)) {
                        selectedDate.value = date;
                        currentStep.value = 3;
                        generateAvailableTimes();
                    }
                };

                const selectTime = (time) => {
                    if (isTimeAvailable(time)) {
                        selectedTime.value = time;
                        currentStep.value = 4;
                    }
                };

                const nextStep = () => {
                    if (currentStep.value < 5) {
                        currentStep.value++;
                    }
                };

                const previousStep = () => {
                    if (currentStep.value > 1) {
                        currentStep.value--;
                    }
                };

                const fetchAdminPhoneNumber = async () => {
                    try {
                        const { data, error } = await supabase
                            .from('admin_configurations')
                            .select('phone')
                            .eq('admin_unique_code', adminCode.value)
                            .single();
                        if (error) throw error;
                        adminPhoneNumber.value = data.phone;
                    } catch (error) {
                        console.error('Error fetching admin phone number:', error);
                        showNotification('Error al cargar el n煤mero de tel茅fono del administrador.', 'error');
                    }
                };

                const addToCart = (product) => {
                    cart.value.push(product);
                    showNotification('Producto agregado al carrito.', 'success');
                };

                const removeFromCart = (item) => {
                    const index = cart.value.findIndex(cartItem => cartItem.id === item.id);
                    if (index !== -1) {
                        cart.value.splice(index, 1);
                        showNotification('Producto eliminado del carrito.', 'success');
                    }
                };

                const saveOrderToDatabase = async () => {
                    try {
                        const orderItems = cart.value.map(item => ({
                            admin_unique_code: adminCode.value,
                            product_id: item.id,
                            quantity: 1, // Assuming quantity is always 1, adjust if needed
                            price: item.price,
                            product_name: item.name
                        }));

                        const { data, error } = await supabase
                            .from('order_items')
                            .insert(orderItems);

                        if (error) throw error;

                        showNotification('Pedido guardado exitosamente', 'success');
                    } catch (error) {
                        console.error('Error saving order:', error);
                        showNotification('Error al guardar el pedido. Por favor, intenta de nuevo.', 'error');
                    }
                };

                const generateWhatsAppMessageForCart = () => {
                    let message = ' *Resumen del Pedido*:\n\n';
                    cart.value.forEach(item => {
                        message += `锔 *${item.name}* - $${item.price}\n`;
                    });
                    message += `\n *Total*: $${cartTotal.value}`;
                    return encodeURIComponent(message);
                };


                const checkoutAndRedirect = async () => {
                    isProcessing.value = true;
                    showNotification('Procesando tu pedido...', 'info');

                    try {
                        await saveOrderToDatabase();
                        const message = generateWhatsAppMessageForCart();
                        const whatsappUrl = `https://wa.me/${adminPhoneNumber.value}?text=${message}`;
                        window.open(whatsappUrl, '_blank');
                        cart.value = []; // Clear the cart after redirecting
                        showNotification('Pedido enviado por WhatsApp. Gracias por su compra!', 'success');
                    } catch (error) {
                        console.error('Error processing order:', error);
                        showNotification('Error al procesar el pedido. Por favor, intenta de nuevo.', 'error');
                    } finally {
                        isProcessing.value = false;
                    }
                };

                const showNotification = (message, type = 'info') => {
                    notification.value = { show: true, message, type };
                    setTimeout(() => {
                        notification.value.show = false;
                    }, 3000);
                };

                const resetBookingForm = () => {
                    selectedServices.value = [];
                    currentStep.value = 1;
                    selectedDate.value = null;
                    selectedTime.value = null;
                    clientName.value = '';
                    clientPhone.value = '';
                    clientEmail.value = '';
                    paymentInfo.value = { cardNumber: '', expiryDate: '', cvv: '' };
                    termsAccepted.value = false;
                };

                const sendMessage = () => {
                    if (chatInput.value.trim()) {
                        chatMessages.value.push({ sender: 'user', text: chatInput.value });
                        chatInput.value = '';
                        // Simulate a response from the support team
                        setTimeout(() => {
                            chatMessages.value.push({ sender: 'support', text: 'Gracias por tu mensaje. Un agente de soporte te responder谩 pronto.' });
                        }, 1000);
                    }
                };

                const closeConfirmationModal = () => {
                    showConfirmationModal.value = false;
                };

                const isDateAvailable = (date) => {
                    const dayOfWeek = date.getDay();
                    const businessHoursForDay = businessHours.value.find(bh => bh.day_of_week === dayOfWeek);
                    return businessHoursForDay && businessHoursForDay.is_working_day;
                };

                const isDateInPast = (date) => {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    return date < today;
                };

                const isToday = (date) => {
                    const today = new Date();
                    return date.getDate() === today.getDate() &&
                           date.getMonth() === today.getMonth() &&
                           date.getFullYear() === today.getFullYear();
                };

                const previousMonth = () => {
                    currentDate.value = new Date(currentDate.value.getFullYear(), currentDate.value.getMonth() - 1, 1);
                };

                const nextMonth = () => {
                    currentDate.value = new Date(currentDate.value.getFullYear(), currentDate.value.getMonth() + 1, 1);
                };

                const generateAvailableTimes = () => {
                    if (!selectedDate.value) return;

                    const dayOfWeek = selectedDate.value.getDay();
                    const businessHoursForDay = businessHours.value.find(bh => bh.day_of_week === dayOfWeek);

                    if (!businessHoursForDay || !businessHoursForDay.is_working_day) {
                        availableTimes.value = [];
                        return;
                    }

                    const openTime = new Date(`2000-01-01T${businessHoursForDay.open_time}`);
                    const closeTime = new Date(`2000-01-01T${businessHoursForDay.close_time}`);
                    const times = [];

                    while (openTime < closeTime) {
                        times.push(openTime.toTimeString().slice(0, 5));
                        openTime.setMinutes(openTime.getMinutes() + 30);
                    }

                    availableTimes.value = times;
                };

                const getReservationName = (date, time) => {
                    if (!date) return '';

                    const dateString = date.toISOString().split('T')[0];
                    const booking = bookings.value.find(booking =>
                        booking.date === dateString &&
                        booking.time === time &&
                        booking.status !== 'cancelled'
                    );
                    return booking ? booking.client_name : '';
                };

                const formatDisplayTime = (time) => {
                    // Convertir '09:00:00' a '09:00'
                    return time.slice(0, 5);
                };

                const availableTimes = computed(() => {
                    if (!selectedDate.value) return [];

                    const dayOfWeek = selectedDate.value.getDay();
                    const businessHoursForDay = businessHours.value.find(bh => bh.day_of_week === dayOfWeek);
                    if (!businessHoursForDay) return [];

                    const openTime = new Date(`1970-01-01T${businessHoursForDay.open_time}`);
                    const closeTime = new Date(`1970-01-01T${businessHoursForDay.close_time}`);
                    const times = [];

                    for (let time = openTime; time < closeTime; time.setMinutes(time.getMinutes() + 30)) {
                        times.push(time.toTimeString().slice(0, 8)); // Formato '09:00:00'
                    }

                    return times;
                });

                const isFullyBooked = (date)  => {
                    if (!date) return false;

                    const bookingDate = date.toISOString().split('T')[0];
                    const dayBookings = bookings.value.filter(b => b.date === bookingDate);

                    const dayOfWeek = date.getDay();
                    const businessHoursForDay = businessHours.value.find(bh => bh.day_of_week === dayOfWeek);

                    if (!businessHoursForDay || !businessHoursForDay.is_working_day) return true;

                    const openTime = new Date(`2000-01-01T${businessHoursForDay.open_time}`);
                    const closeTime = new Date(`2000-01-01T${businessHoursForDay.close_time}`);
                    let availableSlots = 0;

                    while (openTime < closeTime) {
                        const timeSlot = openTime.toTimeString().slice(0, 5);
                        if (!dayBookings.some(b => b.time === timeSlot)) {
                            availableSlots++;
                        }
                        openTime.setMinutes(openTime.getMinutes() + 30);
                    }

                    return availableSlots === 0;
                };

                const hasLimitedAvailability = (date) => {
                    if (!date) return false;

                    const bookingDate = date.toISOString().split('T')[0];
                    const dayBookings = bookings.value.filter(b => b.date === bookingDate);

                    const dayOfWeek = date.getDay();
                    const businessHoursForDay = businessHours.value.find(bh => bh.day_of_week === dayOfWeek);

                    if (!businessHoursForDay || !businessHoursForDay.is_working_day) return false;

                    const openTime = new Date(`2000-01-01T${businessHoursForDay.open_time}`);
                    const closeTime = new Date(`2000-01-01T${businessHoursForDay.close_time}`);
                    let totalSlots = 0;
                    let bookedSlots = 0;

                    while (openTime < closeTime) {
                        const timeSlot = openTime.toTimeString().slice(0, 5);
                        totalSlots++;
                        if (dayBookings.some(b => b.time === timeSlot)) {
                            bookedSlots++;
                        }
                        openTime.setMinutes(openTime.getMinutes() + 30);
                    }

                    const availabilityPercentage = (totalSlots - bookedSlots) / totalSlots;
                    return availabilityPercentage <= 0.3 && availabilityPercentage > 0;
                };

                // Watchers
                watch(selectedServices, () => {
                    if (currentStep.value === 1 && selectedServices.value.length > 0) {
                        currentStep.value = 2;
                    }
                });


                watch(() => currentStep.value, (newStep) => {
                    if (newStep === 5) {
                        nextTick(() => {
                            initMercadoPago();
                        });
                    }
                });

                const isBreakTime = (time) => {
                    if (!selectedDate.value) return false;

                    const bookingDate = selectedDate.value.toISOString().split('T')[0];
                    const existingBookings = bookings.value.filter(booking =>
                        booking.date === bookingDate
                    );

                    for (const booking of existingBookings) {
                        const serviceDuration = getServiceDuration(booking.service_name);
                        const breakStartTime = new Date(`2000-01-01T${addMinutesToTime(booking.time, serviceDuration)}`);
                        const breakEndTime = new Date(`2000-01-01T${addMinutesToTime(booking.time, serviceDuration + 30)}`);
                        const currentTime = new Date(`2000-01-01T${time}`);

                        if (currentTime >= breakStartTime && currentTime < breakEndTime) {
                            return true;
                        }
                    }

                    return false;
                };

                const getReservationDuration = (time) => {
                    if (!selectedDate.value) return '';

                    const bookingDate = selectedDate.value.toISOString().split('T')[0];
                    const existingBooking = bookings.value.find(booking =>
                        booking.date === bookingDate && booking.time === time
                    );

                    if (existingBooking) {
                        return getServiceDuration(existingBooking.service_name);
                    }

                    return '';
                };

                const calculateEndTime = (startTime, duration) => {
  const [hours, minutes] = startTime.split(':').map(Number);
  let endDate = new Date(2000, 0, 1, hours, minutes + duration);
  return endDate.toTimeString().slice(0, 5);
};

                    const generateWhatsAppMessage = (booking) => {
                        let message = 'Resumen de la reserva:\n\n';
                        message += `N煤mero de Reserva: ${bookingNumber.value}\n`;
                        message += `Servicio: ${booking.service_name}\n`;
                        message += `Fecha: ${formatDate(new Date(booking.date))}\n`;
                        message += `Hora de inicio: ${booking.time}\n`;
                        message += `Hora de finalizaci贸n: ${booking.end_time}\n`;
                        message += `Precio Total: $${booking.price}\n`;
                        message += `Se帽a Pagada: $${booking.deposit_amount}\n`;
                        message += `Nombre: ${booking.client_name}\n`;
                        message += `Tel茅fono: ${booking.client_phone}\n`;
                        return message;
                    };



                    const confirmBooking = async (paymentStatus) => {
                        if (paymentStatus !== 'approved') {
                            showNotification('El pago no fue aprobado. Por favor, intenta de nuevo.', 'error');
                            return;
                        }

                        isProcessingPayment.value = true;
                        showNotification('Procesando tu reserva...', 'info');

                        try {
                            retrieveBookingDetails();

                            if (!selectedDate.value) {
                                throw new Error('No se encontraron detalles de la reserva');
                            }

                            const selectedService = selectedServices.value[0]; // Assuming single service selection
                            const endTime = calculateEndTime(selectedTime.value, selectedService.duration);

                            const booking = {
                                admin_unique_code: adminCode.value,
                                client_id: generateUUID(),
                                service_name: selectedServices.value.map(s => s.name).join(', '),
                                date: selectedDate.value.toISOString().split('T')[0],
                                time: selectedTime.value,
                                end_time: endTime,
                                price: totalPrice.value,
                                status: 'confirmed',
                                payment_status: 'deposit_paid',
                                deposit_amount: depositAmount.value,
                                client_name: clientName.value,
                                client_phone: clientPhone.value,
                                client_email: clientEmail.value
                            };

                            const { data, error } = await supabase
                                .from('bookings')
                                .insert([booking]);

                            if (error) throw error;

                            showNotification('Reserva confirmada y se帽a procesada con 茅xito!', 'success');
                            
                            bookingNumber.value = `RES-${Date.now()}-${Math.floor(Math.random() * 1000)}`;
                            showConfirmationModal.value = true;

                            const message = generateWhatsAppMessage(booking);
                            const whatsappUrl = `https://wa.me/${adminPhoneNumber.value}?text=${encodeURIComponent(message)}`;
                            
                            window.open(whatsappUrl, '_blank');

                            setTimeout(() => {
                                window.location.href = whatsappUrl;
                            }, 2000);

                            resetBookingForm();
                            currentStep.value = 1;
                            localStorage.removeItem('bookingDetails');
                        } catch (error) {
                            console.error('Error al procesar la reserva:', error);
                            showNotification('Hubo un error al procesar tu reserva. Por favor, intenta de nuevo.', 'error');
                        } finally {
                            isProcessingPayment.value = false;
                        }
                    };

                // Return the reactive state and methods
                return {
                    appTitle,
                    appSubtitle,
                    promotions,
                    formatDate,
                    formatCountdown,
                    fullPromotions,
                    filteredServicesAndPartialPromos,
                    currentTab,
                    currentStep,
                    promotions,
                    formatDate,
                    formatCountdown,
                    selectPromotion,
                    isProcessingPayment,
                    currentTab,
                    searchQuery,
                    filteredServices,
                    filteredProducts,
                    selectedServices,
                    getReservationInfo,
                    getServiceDuration,
                    addMinutesToTime,
                    currentStep,
                    selectedDate,
                    getReservedSlotNumber,
                    selectedTime,
                    isTimeAvailable,
                    getReservationDuration,
                    isTimeAvailable,
                    isBreakTime,
                    getReservationDuration,
                    clientName,
                    clientPhone,
                    clientEmail,
                    paymentInfo,
                    termsAccepted,
                    cart,
                    notification,
                    showChat,
                    chatMessages,
                    chatInput,
                    showTermsModal,
                    showConfirmationModal,
                    bookingNumber,
                    loyaltyPoints,
                    currentDate,
                    currentMonthName,
                    currentYear,
                    daysOfWeek,
                    calendarDays,
                    availableTimes,
                    totalPrice,
                    depositAmount,
                    cartTotal,
                    isProcessing,
                    isLoading,
                    setCurrentTab,
                    toggleService,
                    isServiceSelected,
                    selectDate,
                    selectTime,
                    nextStep,
                    previousStep,
                    confirmBooking,
                    addToCart,
                    removeFromCart,
                    sendMessage,
                    closeConfirmationModal,
                    formatDate,
                    isDateAvailable,
                    isDateInPast,
                    isToday,
                    previousMonth,
                    nextMonth,
                    isTimeAvailable,
                    formatDisplayTime,
                    getReservationName,
                    isFullyBooked,
                    hasLimitedAvailability,
                    checkoutAndRedirect,
                    confirmBooking,
                    preferenceId,
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
